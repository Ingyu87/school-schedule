<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™êµ ì„ íƒ - ê´€ë¦¬ì</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-purple-50 min-h-screen flex items-center justify-center">
    <div class="max-w-4xl w-full mx-4">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-purple-100 rounded-full mb-4">
                    <i class="fa-solid fa-key text-purple-600 text-4xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">ê´€ë¦¬ì ëª¨ë“œ</h1>
                <p class="text-gray-600">ì ‘ê·¼í•  í•™êµë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
            </div>
            
            <div class="mb-6">
                <input 
                    type="text" 
                    id="school-search"
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition"
                    placeholder="ğŸ” í•™êµëª…ìœ¼ë¡œ ê²€ìƒ‰..."
                    oninput="filterSchools()"
                >
            </div>
            
            <div id="school-list" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto">
                <!-- í•™êµ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
            
            <div class="mt-6 text-center">
                <button onclick="logout()" class="text-sm text-gray-500 hover:text-gray-700">
                    <i class="fa-solid fa-sign-out-alt mr-1"></i>ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
        </div>
    </div>
    
    <!-- Firebase ì´ˆê¸°í™” -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyATebSC3BCAlTVUO_ybyg1OoIdqgBlxFBc",
            authDomain: "school-schedule-d16bc.firebaseapp.com",
            projectId: "school-schedule-d16bc",
            storageBucket: "school-schedule-d16bc.firebasestorage.app",
            messagingSenderId: "173998479308",
            appId: "1:173998479308:web:b1ea6a69c743d838a5ef69",
            measurementId: "G-NPPXKJCGGB"
        };
        
        const firebaseApp = initializeApp(firebaseConfig);
        window.firebaseDb = getFirestore(firebaseApp);
        
        // í•™êµ ëª©ë¡ ë¡œë“œ
        loadSchools();
    </script>
    
    <script>
        // ë§ˆìŠ¤í„°í‚¤ í™•ì¸
        const saved = localStorage.getItem('current_school');
        if (!saved || JSON.parse(saved).name !== 'MASTER') {
            window.location.href = 'login.html';
        }
        
        async function loadSchools() {
            try {
                const { collection, getDocs } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js");
                const schoolsRef = collection(window.firebaseDb, 'schools');
                const snapshot = await getDocs(schoolsRef);
                
                const schools = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    schools.push({
                        name: data.name || doc.id,
                        createdAt: data.createdAt || ''
                    });
                });
                
                // ì´ë¦„ìˆœ ì •ë ¬
                schools.sort((a, b) => a.name.localeCompare(b.name));
                
                renderSchools(schools);
            } catch (error) {
                console.error('Load schools error:', error);
                document.getElementById('school-list').innerHTML = 
                    '<div class="col-span-2 text-center text-gray-500 p-4">í•™êµ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }
        
        function renderSchools(schools) {
            const listEl = document.getElementById('school-list');
            if (schools.length === 0) {
                listEl.innerHTML = '<div class="col-span-2 text-center text-gray-500 p-4">ë“±ë¡ëœ í•™êµê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            listEl.innerHTML = schools.map(school => `
                <div class="school-card bg-gradient-to-br from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-lg p-4 cursor-pointer hover:shadow-lg transition" 
                     onclick="selectSchool('${school.name}')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-bold text-lg text-gray-900">${school.name}</h3>
                            ${school.createdAt ? `<p class="text-xs text-gray-500 mt-1">ë“±ë¡ì¼: ${new Date(school.createdAt).toLocaleDateString('ko-KR')}</p>` : ''}
                        </div>
                        <i class="fa-solid fa-chevron-right text-indigo-600"></i>
                    </div>
                </div>
            `).join('');
        }
        
        window.filterSchools = function() {
            const searchTerm = document.getElementById('school-search').value.toLowerCase();
            const cards = document.querySelectorAll('.school-card');
            
            cards.forEach(card => {
                const schoolName = card.textContent.toLowerCase();
                if (schoolName.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        };
        
        window.selectSchool = function(schoolName) {
            // ì„ íƒí•œ í•™êµë¡œ ë¡œê·¸ì¸ (ë§ˆìŠ¤í„°í‚¤ ê¶Œí•œ ìœ ì§€)
            const currentSchool = { name: schoolName, isMaster: true };
            localStorage.setItem('current_school', JSON.stringify(currentSchool));
            window.location.href = 'index.html';
        };
        
        window.logout = function() {
            if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('current_school');
                window.location.href = 'login.html';
            }
        };
    </script>
</body>
</html>

